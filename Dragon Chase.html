<html><head><title>Dragon Chase</title><script src="jquery-2.1.4.js"></script>
<script src="Daniel's tools.js"></script><style>
div {
	position: absolute;
	height: 10px;
	width: 10px;
	background-color: black;
}
img#guy {
	position: absolute;
	width: 75px;
	left: 100px;
	top: 1px;
}
div#lava {
	background-color: red;
	top: 750px;
	left: 0px;
}
</style></head><body>
<span id="world"></span>
</body><script>
var platform_up = new Map();
run_loop();
move_platforms();
var going_left = false,
	going_right = false;
function run_loop() {
	if (going_left) {
		move(-1,0);
	}
	if (going_right) {
		move(1,0);
	}
	if (parseFloat($("#guy").css('top')) + 94 > parseFloat($("#lava").css('top'))) {
		$("#guy").css('top', '1px');
		$("#guy").css('left', '100px');
	}
	setTimeout(run_loop, 0);
}
$(document).keydown(function(e) {
		if (e.which == 37) {
			going_left = true;
		}
		if (e.which == 39) {
			going_right = true;
		}
		if (falls < 5 && !jumping && e.which == 32) {
			speed = -5;
			jump();
			jumping = true;
		}
});
$(document).keyup(function(e) {
	switch(e.which) {
		case 37:
			going_left = false;
			break;
		case 39:
			going_right = false;
			break;
	}
});
var	jumping = false,
	speed = 0.1,
	accel = 0.05,
	falls = 0;
fall();
function fall() {
	if (!jumping) {
		falls++;
		movedown($('#guy'), speed);
		speed += accel;
		$('div').each(function() {
			if (overlap($('#guy'), $(this))) {
				$('#guy').css('top', parseFloat($(this).css('top')) - 89 + 'px');
				speed = 0.1;
				falls = 0;
			}
		});
	}
	setTimeout(fall, 2);
}
function jump() {
	movedown($('#guy'), speed);
	speed += accel;
	$('div').each(function() {
		if (overlap($('#guy'), $(this))) {
			movedown($('#guy'), 10);
			speed = 0;
		}
	});
	if (speed < 0) {
		setTimeout(jump, 2);
	} else {
		jumping = false;
	}
}

function move(x,y) {
	$(this).css('left', $(this).css('left') + x);
	$(this).css('top', $(this).css('top') - y);
}
</script></html>